<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="nhoy official website">
    <title>nhoy Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head>
<body>
    <div class="header">
        <div class="logo">
            <a href="/">
                <img src="https://i.pinimg.com/736x/17/94/ea/1794ea7f66d326bd3224aac4a33b67e7.jpg" alt="logo">
            </a>
        </div>
        <button class="menu-btn" id="menu-btn-action">
            <i class="fa-solid fa-bars"></i>
        </button>
    </div>

    <div class="main-content">
        <div id="public-content">
            <div class="hero-slider" id="banner-slider">
                <div class="slider-wrapper"></div>
                <button class="slider-arrow arrow-left"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="slider-arrow arrow-right"><i class="fa-solid fa-chevron-right"></i></button>
                <div class="dots-container"></div>
            </div>

            <div class="section-title">
                <h2><i class="fa-solid fa-fire"></i> Roblox Hacks</h2>
                <a href="#">View All <i class="fa-solid fa-arrow-right"></i></a>
            </div>

            <div class="app-grid">
                <div class="app-card" data-app="delta">
                    <img src="https://deltaios-executor.com/Icon.jpg" alt="Delta" class="app-icon">
                    <div class="app-info">
                        <h3>Roblox (Delta)</h3>
                        <p>Premium executor for iOS</p>
                    </div>
                    <button class="download-btn">
                        <i class="fa-solid fa-download"></i>
                    </button>
                </div>
                <div class="app-card" data-app="krnl">
                    <img src="https://krnl-ios.com/unnamed.png" alt="KRNL" class="app-icon">
                    <div class="app-info">
                        <h3>Roblox (KRNL)</h3>
                        <p>Powerful script executor</p>
                    </div>
                    <button class="download-btn">
                        <i class="fa-solid fa-download"></i>
                    </button>
                </div>
            </div>

            <div class="section-title">
                <h2><i class="fa-solid fa-code"></i> Featured Scripts</h2>
                <a href="#">More Scripts <i class="fa-solid fa-arrow-right"></i></a>
            </div>

            <div class="hero-slider2" id="banner-slider2">
                <div class="slider-wrapper" id="script-slider-wrapper"></div>
                <button class="slider-arrow arrow-left" id="script-left"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="slider-arrow arrow-right" id="script-right"><i class="fa-solid fa-chevron-right"></i></button>
                <div class="dots-container" id="script-dots"></div>
            </div>

            <div class="section-title">
                <h2><i class="fa-solid fa-code"></i> Popular Scripts</h2>
                <a href="#">More Scripts <i class="fa-solid fa-arrow-right"></i></a>
            </div>

            <div class="script-grid" id="scripts-container"></div>
            
        </div>
    </div>

    <div class="modal-overlay" id="downloadModal">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <div class="modal-header">
                <h2>Ready to Download</h2>
                <p>Your download is prepared</p>
            </div>
            <img src="" alt="App Icon" class="modal-app-icon" id="modal-icon">
            <h3 id="modal-app-name" style="margin-bottom: 8px;"></h3>
            <p>Thanks for your support! Click below to start your download.</p>
            <button class="unlock-btn" id="final-download">
                <i class="fa-solid fa-download"></i>
                <span>Download Now</span>
            </button>
        </div>
    </div>
    
    <div class="login-overlay" id="login-overlay">
        <div class="login-content">
            <button class="close-btn" id="close-login-btn">&times;</button>
            <h2>Admin Login</h2>
            <form id="login-form">
                <div class="input-container">
                    <i class="fa-solid fa-lock"></i>
                    <input type="password" id="password-input" placeholder="Enter Password" required autocomplete="current-password">
                </div>
                <button type="submit">
                    <span id="login-btn-text">Login <i class="fa-solid fa-arrow-right-to-bracket"></i></span>
                </button>
                <p id="login-error" class="login-error-message"></p>
            </form>
        </div>
    </div>

    <footer id="footer-contact">
        <div class="footer-content">
            <div class="footer-section about-section">
                <a href="#" class="footer-logo-container">
                    <img src="https://i.pinimg.com/736x/99/90/d5/9990d5085e3e70c9cd0fb416bc668f59.jpg" alt="nhoy official Logo" class="footer-logo" loading="lazy">
                    <span class="footer-logo-text">nhoy Hub</span>
                </a>
                <p>Your source for esign, Trollstore, and other iOS utilities. Providing free downloads and resources for the community.</p>
                <div class="social-links">
                    <a href="https://nhoy_11.t.me" target="_blank" rel="noopener noreferrer" aria-label="Telegram"><i class="fab fa-telegram"></i></a>
                    <a href="https://web.facebook.com/jkj.nha.2025/?rdid=0wBfBtdXtoKp2bqC" target="_blank" rel="noopener noreferrer" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://youtube.com/@xai-qq?si=uPsNoogH7OaNU__O" target="_blank" rel="noopener noreferrer" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section links-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">ESIGN</a></li>
                    <li><a href="#">Roblox Hack</a></li>
                    <li><a href="#">Troll Store</a></li>
                    <li><a href="#">About</a></li>
                </ul>
            </div>
            <div class="footer-section contact-section">
                <h3>Contact Us</h3>
                <ul class="contact-info">
                    <li><i class="fas fa-envelope"></i> <span>For support, please reach out via our social channels.</span></li>
                    <li><i class="fas fa-info-circle"></i> <span>We do not offer direct phone or email support at this time.</span></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        
       const API_BASE = "https://nhoyscript.onrender.com";



        const banners = [
            "https://i.pinimg.com/736x/0e/be/63/0ebe63a7b480ea035e83ca3e5e419ad5.jpg",
            "https://i.pinimg.com/1200x/62/5d/af/625daf1f2dccfced38f1a879205653e1.jpg",
            "https://i.pinimg.com/736x/a1/1f/4f/a11f4fb56c576b01a5a1dc1075efb425.jpg"
        ];
        
        const apps = {
            delta: { name: "Roblox (Delta)", icon: "https://deltaios-executor.com/Icon.jpg", url: "itms-services://?action=download-manifest&url=https%3A%2F%2Fdeltaios-executor.com%2FInstall21.plist" },
            krnl: { name: "Roblox (KRNL)", icon: "https://krnl-ios.com/unnamed.png", url: "itms-services://?action=download-manifest&url=https://krnl-ios.com/Install2.plist" }
        };

        let allScripts = [];

        // === DATA FETCHING ===
        async function loadScriptsFromAPI() {
            try {
                const response = await fetch(`${API_BASE}/api/scripts`);
                if (!response.ok) throw new Error("Failed to fetch scripts from API");
                allScripts = await response.json();
            } catch (error) {
                console.error("Error loading scripts:", error);
                allScripts = []; 
            }
        }

        // === TELEGRAM NOTIFICATIONS ===
        async function sendCopyNotification(scriptTitle, scriptKey) {
            try {
                await fetch(`${API_BASE}/api/notify/copy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        title: scriptTitle, 
                        key: scriptKey,
                        time: new Date().toLocaleString()
                    })
                });
            } catch (error) {
                console.error('Error sending notification:', error);
            }
        }

        // === SLIDER FUNCTIONS ===
        function initializeGenericSlider(sliderId, bannerArray) {
            const slider = document.querySelector(sliderId);
            if (!slider) return;
            
            const sliderWrapper = slider.querySelector('.slider-wrapper');
            const dotsContainer = slider.querySelector('.dots-container');
            let currentSlide = 0;

            sliderWrapper.innerHTML = ''; 
            dotsContainer.innerHTML = '';

            bannerArray.forEach((banner, idx) => {
                const slide = document.createElement('div');
                slide.className = 'slide';
                slide.innerHTML = `<img src="${banner}" alt="Banner ${idx + 1}" loading="lazy">`;
                sliderWrapper.appendChild(slide);

                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.addEventListener('click', () => goToSlide(idx));
                dotsContainer.appendChild(dot);

            });

            function updateSlider() {
                if (sliderWrapper && sliderWrapper.style) {
                    sliderWrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
                }
                slider.querySelectorAll('.dot').forEach((dot, idx) => {
                    dot.classList.toggle('active', idx === currentSlide);
                });
            }
            function goToSlide(idx) {
                currentSlide = idx;
                updateSlider();
            }
            slider.querySelector('.arrow-left').addEventListener('click', () => {
                currentSlide = (currentSlide - 1 + bannerArray.length) % bannerArray.length;
                updateSlider();
            });
            slider.querySelector('.arrow-right').addEventListener('click', () => {
                currentSlide = (currentSlide + 1) % bannerArray.length;
                updateSlider();
            });
            setInterval(() => {
                currentSlide = (currentSlide + 1) % bannerArray.length;
                updateSlider();
            }, 5000);
            updateSlider();
        }

        // === SCRIPT RENDERING ===
        function createScriptCard(script) {
            const card = document.createElement('div');
            card.className = 'script-card';
            card.innerHTML = `
                <img src="${script.image}" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200/5c5470/ffffff?text=Image+Not+Found'" alt="${script.title}" class="script-image" loading="lazy">
                <div class="script-content">
                    <h3 class="script-title">${script.title}</h3>
                    <div class="key-box">${script.key}</div>
                    <button class="copy-button">
                        <i class="fa-solid fa-copy"></i>
                        <span>Copy Script</span>
                    </button>
                </div>
            `;
            const copyBtn = card.querySelector('.copy-button');
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(script.key);
                sendCopyNotification(script.title, script.key); 
                copyBtn.classList.add('copied');
                copyBtn.innerHTML = '<i class="fa-solid fa-check"></i><span>Copied!</span>';
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i><span>Copy Script</span>';
                }, 2000);
            });
            return card;
        }

        function renderAllScriptSections() {
            const scriptSliderWrapper = document.getElementById('script-slider-wrapper');
            const scriptDotsContainer = document.getElementById('script-dots');
            const scriptsContainer = document.getElementById('scripts-container');
            let currentScriptSlide = 0;
            let totalScriptPages = 0;

            scriptSliderWrapper.innerHTML = '';
            scriptDotsContainer.innerHTML = '';
            
            scriptsContainer.innerHTML = '';
            allScripts.forEach(script => {
                scriptsContainer.appendChild(createScriptCard(script));
            });

            const scriptsPerPage = window.innerWidth <= 768 ? 1 : (window.innerWidth <= 1200 ? 2 : 3);
            totalScriptPages = Math.ceil(allScripts.length / scriptsPerPage);

            for (let i = 0; i < totalScriptPages; i++) {
                const page = document.createElement('div');
                page.className = 'slider-page';
                const grid = document.createElement('div');
                grid.className = 'script-grid';
                grid.style.setProperty('--scripts-per-page', scriptsPerPage);
                const pageScripts = allScripts.slice(i * scriptsPerPage, (i * scriptsPerPage) + scriptsPerPage);
                pageScripts.forEach(script => grid.appendChild(createScriptCard(script)));
                page.appendChild(grid);
                scriptSliderWrapper.appendChild(page);
                
                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.addEventListener('click', () => goToScriptSlide(i));
                scriptDotsContainer.appendChild(dot);
            }

            function updateScriptSlider() {
                scriptSliderWrapper.style.transform = `translateX(-${currentScriptSlide * 100}%)`;
                document.querySelectorAll('#script-dots .dot').forEach((dot, idx) => {
                    dot.classList.toggle('active', idx === currentScriptSlide);
                });
            }
            function goToScriptSlide(idx) {
                currentScriptSlide = idx;
                updateScriptSlider();
            }
            document.getElementById('script-left').addEventListener('click', () => {
                currentScriptSlide = (currentScriptSlide - 1 + totalScriptPages) % totalScriptPages;
                updateScriptSlider();
            });
            document.getElementById('script-right').addEventListener('click', () => {
                currentScriptSlide = (currentScriptSlide + 1) % totalScriptPages;
                updateScriptSlider();
            });
            if (totalScriptPages > 0) updateScriptSlider();
        }

        // === MODAL & LOGIN ===
        function initializeModalsAndLogin() {
            const modal = document.getElementById('downloadModal');
            const closeBtn = modal.querySelector('.close-btn');

            document.querySelectorAll('.app-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.download-btn')) {
                        const app = apps[card.dataset.app];
                        document.getElementById('modal-icon').src = app.icon;
                        document.getElementById('modal-app-name').textContent = app.name;
                        document.getElementById('final-download').onclick = () => window.open(app.url, '_blank');
                        modal.classList.add('visible');
                    }
                });
            });
            closeBtn.addEventListener('click', () => modal.classList.remove('visible'));
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('visible'); });

            const loginOverlay = document.getElementById('login-overlay');
            const loginForm = document.getElementById('login-form');
            
            // Menu button: Check backend session, redirect or show login
            document.getElementById('menu-btn-action').addEventListener('click', async () => {
                try {
                    const response = await fetch(`${API_BASE}/api/check-auth`, {
                        credentials: 'include'
                    });
                    const data = await response.json();
                    
                    if (data.authenticated) {
                        window.location.href = `${API_BASE}/admin`;
                    } else {
                        loginOverlay.style.display = 'flex';
                    }
                } catch (error) {
                    console.error('Auth check error:', error);
                    loginOverlay.style.display = 'flex';
                }
            });
            
            const closeLoginModal = () => loginOverlay.style.display = 'none';
            document.getElementById('close-login-btn').addEventListener('click', closeLoginModal);
            loginOverlay.addEventListener('click', (e) => { if(e.target === loginOverlay) closeLoginModal(); });

            // Backend Session Login Handler
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const passwordInput = document.getElementById('password-input');
                const password = passwordInput.value;
                const loginError = document.getElementById('login-error');
                const loginBtn = loginForm.querySelector('button');
                const loginBtnText = document.getElementById('login-btn-text');
                
                loginError.textContent = ''; 
                loginBtnText.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Logging in...';
                loginBtn.disabled = true;

                try {
                    const response = await fetch(`${API_BASE}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ password })
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        loginBtnText.innerHTML = '<i class="fa-solid fa-check"></i> Success! Redirecting...';
                        setTimeout(() => {
                            window.location.href = `${API_BASE}/admin`;
                        }, 500);
                    } else {
                        loginError.textContent = result.message || 'Incorrect password.';
                        loginBtnText.innerHTML = 'Login <i class="fa-solid fa-arrow-right-to-bracket"></i>';
                        loginBtn.disabled = false;
                        passwordInput.value = '';
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    loginError.textContent = 'Connection error. Check backend server.';
                    loginBtnText.innerHTML = 'Login <i class="fa-solid fa-arrow-right-to-bracket"></i>';
                    loginBtn.disabled = false;
                }
            });
        }

        // === INITIAL LOAD ===
        async function initialLoad() {
            await loadScriptsFromAPI();
            renderAllScriptSections();
            initializeGenericSlider('#banner-slider', banners);
            initializeModalsAndLogin();

            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(renderAllScriptSections, 250);
            });
        }
        
        document.addEventListener('DOMContentLoaded', initialLoad);
    </script>
</body>
</html>